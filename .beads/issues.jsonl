{"id":"moon_rodio-51c","title":"Implement source generator/filter slice","description":"Add source-side generators and basic combinators toward rodio source module parity.","notes":"Closed remaining source exported names gap by adding AutomaticGainControl, BltFilter (low/high-pass), WhiteUniform, and Pink implementations with tests.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-02-14T10:54:02.401903+08:00","created_by":"Milky2018","updated_at":"2026-02-14T16:29:55.378753+08:00","closed_at":"2026-02-14T16:29:55.378753+08:00","close_reason":"Completed source generator/filter and exported source type parity with tests."}
{"id":"moon_rodio-6m5","title":"Audit and close remaining rodio parity gaps (non-lifetime)","description":"Compare moon_rodio APIs/behavior against rodio-reference and implement remaining non-lifetime parity gaps with tests.","status":"in_progress","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-02-14T18:12:04.291183+08:00","created_by":"Milky2018","updated_at":"2026-02-14T18:12:07.824577+08:00","comments":[{"id":14,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: aligned ChannelVolume semantics with rodio (mono mixdown + per-output-channel expansion, output channels = factors length, strict set_volume index checks); aligned Speed metadata/seek semantics (total_duration scaled by factor, try_seek mapped by factor) for both functional and named wrappers; added parity tests. Blocker found in moon_cpal: Duration is read-only and only exposes Duration::from_secs, so moon_rodio cannot construct sub-second Duration values for precise nanos-return parity (e.g., total_duration/get_pos with nanos).","created_at":"2026-02-14T10:18:24Z"},{"id":15,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: implemented sink seek path (queue output now forwards try_seek to current source; Sink::try_seek forwards and updates position_samples). Also preserved seek/metadata forwarding through with_done_count and updated sink/spatial tests to assert successful seek behavior.","created_at":"2026-02-14T10:20:47Z"},{"id":18,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: aligned queue/span semantics closer to rodio by implementing SourcesQueueOutput::current_span_len with threshold fallback and queued-source aware behavior; switched ControlledQueueSource metadata/seek methods to forward to inner queue source; added queue current_span_len regression coverage.","created_at":"2026-02-14T12:12:21Z"},{"id":19,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: aligned queue/mixer path further by implementing SourcesQueueOutput::current_span_len semantics (threshold fallback and queued-source awareness), and forwarding ControlledQueueSource current_span_len/total_duration/try_seek to inner queue source; added regression test for queue current_span_len behavior.","created_at":"2026-02-14T12:12:52Z"},{"id":20,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: implemented real TakeDuration named-wrapper behavior (fadeout filter toggle, bounded remaining sample state, seek-aware remaining update, metadata forwarding with duration min), replacing previous no-op set_filter_fadeout/clear_filter. Added regression tests for fadeout shape, clear_filter behavior, and seek behavior.","created_at":"2026-02-14T12:21:37Z"},{"id":21,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: aligned FromFactoryIter metadata/seek behavior with rodio FromIter semantics (current_span_len threshold fallback + seek forwarding to current source) and added dedicated from_factory seek regression tests. Reworked named Limit/LimitSettings away from no-op config: settings now carry threshold/knee/attack/release with rodio-aligned presets, limiter now applies soft-knee gain reduction with attack/release envelope smoothing and state reset on seek, and added tests covering knee/attack/release behavior differences. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (106 passed).","created_at":"2026-02-14T12:29:28Z"},{"id":22,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: fixed track_position parity gap for changing source metadata by making DynSource preserve dynamic channels/sample_rate when built from Source (new DynSource::new_dynamic + to_dyn forwarding closures), then reworked TrackPosition state to track span counters/offset like rodio and refresh span state on seek. Added regression tests for speed-adjusted track_position and cross-span timing via from_factory. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (108 passed).","created_at":"2026-02-14T12:33:24Z"},{"id":23,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: aligned more source semantics with rodio-reference by reworking linear_gain_ramp_with_clamp to use time-based gain progression (per-frame elapsed update), forwarding current_span_len/total_duration/try_seek, and making seek update ramp elapsed time. Also replaced skip_duration's initial one-shot skip with span-aware skipping logic and dynamic metadata forwarding, then added regression coverage for skip_duration length cases and linear-ramp seek behavior. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (109 passed).","created_at":"2026-02-14T12:37:29Z"},{"id":24,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: continued dynamic-metadata parity by switching several compositional filters to DynSource::new_dynamic (amplify/take/mix/speed, skip_duration/take_duration/delay wrappers, limit/crossfade wrappers) so channels/sample_rate follow upstream source spans. Refined skip_duration span-aware skip arithmetic to avoid drift and match expected sample counts, while keeping dynamic metadata forwarding. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (109 passed).","created_at":"2026-02-14T12:38:50Z"},{"id":25,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: aligned SignalGenerator/waveform seek semantics and sawtooth phase with rodio-style behavior: SignalGenerator now supports try_seek via phase remap, Sine/Square/Sawtooth/Triangle wrappers now forward try_seek to inner generator, and sawtooth waveform formula now starts at 0.0 like upstream signal_generator. Added regression tests for waveform seek reset and updated sawtooth expectations. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (110 passed).","created_at":"2026-02-14T12:41:06Z"},{"id":26,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: aligned crossfade semantics to rodio-reference (crossfade now returns only the overlapped fade segment by composing TakeDuration + fadeout filter + FadeIn and then mix), and updated crossfade tests to verify bounded output length/shape. Removed stale helper in source_effects_ext after refactor. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (110 passed).","created_at":"2026-02-14T13:43:06Z"},{"id":27,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: extended periodic access API toward rodio parity by adding periodic_access_with_source / periodic_with_source (callbacks can now mutate the inner source), while preserving existing no-arg periodic APIs as wrappers for backward compatibility. Added regression test demonstrating callback-driven seek mutation behavior. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (111 passed).","created_at":"2026-02-14T13:45:08Z"},{"id":28,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: aligned empty-source duration semantics with rodio by making empty/empty-callback report total_duration = Some(0s) instead of None, and added assertions in tests to lock this behavior. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (111 passed).","created_at":"2026-02-14T13:46:10Z"},{"id":29,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: aligned Pausable internal state machine with rodio semantics by storing paused_channels instead of a plain paused bool, so pause/resume transitions mirror upstream behavior and paused channel width is captured at pause time. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (111 passed).","created_at":"2026-02-14T13:47:07Z"},{"id":30,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: mirrored remaining periodic-reference tests from rodio (stereo periodic callback cadence and fast-access/short-period non-overflow case) into source_ext_test to lock periodic behavior during further parity refactors. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (113 passed).","created_at":"2026-02-14T13:48:07Z"},{"id":31,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: ported additional rodio signal_generator behavioral checks (square/triangle/saw/sine wave sequences at reference rates/frequencies) into moon_rodio tests to lock waveform parity. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (114 passed).","created_at":"2026-02-14T13:48:59Z"},{"id":32,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: fixed EmptyCallback behavior mismatch with rodio by invoking callback on every next() call (instead of only first call), updated tests accordingly, and regenerated interface metadata. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (114 passed).","created_at":"2026-02-14T13:50:23Z"},{"id":33,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: aligned zero-source seek semantics closer to rodio by making zero/zero_samples accept try_seek (return Ok), and made finite zero_samples expose current_span_len based on remaining samples. Added regression assertions for seek + span metadata and adjusted default seek-not-supported test to use Empty source. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (114 passed).","created_at":"2026-02-14T13:57:01Z"},{"id":34,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: added named LinearGainRamp::new_with_clamp API to expose rodio-style clamp_end control at wrapper level (existing new keeps clamp=true behavior), plus regression test for unclamped named wrapper output. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (114 passed).","created_at":"2026-02-14T13:57:59Z"},{"id":35,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: aligned Mix construction closer to rodio by wrapping both inputs with UniformSourceIterator at left source format, so mix metadata now follows rodio semantics (current_span_len stays None through uniform wrappers; total_duration resolves via max when both sides are known). Added regression test rodio::source::mix_metadata. Also ported key decoder seek parity checks from rodio tests: seek_beyond_end_saturates, seek_possible_after_exhausting_source, and seek_results_in_correct_remaining_playtime (using 1Hz WAV fixture for deterministic duration mapping). Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (118 passed).","created_at":"2026-02-14T14:04:38Z"},{"id":36,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: aligned repeat_infinite behavior closer to rodio Repeat by adding seek forwarding and span reporting to SamplesBuffer::repeat_infinite. The repeated source now exposes current_span_len as remaining samples until loop boundary and supports try_seek with loop wrap semantics. Added regression test rodio::source::repeat_infinite_seek_and_span. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (119 passed).","created_at":"2026-02-14T14:06:27Z"},{"id":37,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: ported remaining upstream crossfade unit behavior by adding self-crossfade parity assertions (crossfadeing identical sources yields identity over overlap window, with epsilon checks for floating-point rounding). Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (119 passed).","created_at":"2026-02-14T14:07:18Z"},{"id":38,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: fixed Buffered wrapper seek parity mismatch. In upstream rodio, Buffered::try_seek is NotSupported; moon_rodio named Buffered had incorrectly forwarded seek to inner SamplesBuffer. Updated Source impl for Buffered to return NotSupported and added regression assertions in named_wrappers_inner_accessors test. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (119 passed).","created_at":"2026-02-14T14:08:41Z"},{"id":39,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: corrected repeat seek semantics after re-checking upstream internals. rodio Repeat delegates seek to Buffered, and Buffered seek is NotSupported; therefore moon_rodio repeat_infinite seek support was removed to match parity. Kept repeat span metadata coverage and updated regression test to assert SeekError::NotSupported. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (119 passed).","created_at":"2026-02-14T14:09:30Z"},{"id":40,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: added decoder parity coverage for remaining rodio seek/duration behaviors. New tests verify exact total_duration mapping for reference MP3/FLAC/Vorbis fixtures, and verify that seek restores stereo channel alignment even after odd-index sample consumption. Also introduced stereo WAV fixture builder helper for deterministic channel-order tests. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (121 passed).","created_at":"2026-02-14T14:16:52Z"},{"id":41,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: fixed queue clear parity gap. SourcesQueueInput::clear now only clears pending queued sources (matching rodio queue semantics) and no longer resets/drops the currently playing source. Removed reset_version/sync_reset machinery and added regression test rodio::queue::tests::clear_keeps_current_source. Updated Sink::stop and Sink::clear to explicitly skip the current source after clearing pending queue so sink behavior remains immediate-stop/clear. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (122 passed).","created_at":"2026-02-14T14:18:45Z"},{"id":42,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: added parity coverage for queue runtime keep-alive toggling and decoder builder fallback paths. New queue test verifies set_keep_alive_if_empty(false) while consuming fallback silence causes queue to stop after the current threshold chunk. New decoder tests verify MIME-based decode selection and bad-hint fallback to auto-detection. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (124 passed).","created_at":"2026-02-14T14:19:52Z"},{"id":43,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: aligned queue seek behavior with rodio contract ('seek current source only') by removing pending-source promotion in SourcesQueueOutput::try_seek. Added regression test proving try_seek on initial empty current source returns NotSupported without consuming pending queued source. Also updated internal make_zero_dyn_source metadata/seek behavior to match zero-source expectations (current_span_len + seek support), preventing fallback-seek regressions in sink/spatial paths. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (125 passed).","created_at":"2026-02-14T14:21:41Z"},{"id":44,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: adopted raylib-style prebuild automation for linker flags in moon_rodio. Added build.js and enabled --moonbit-unstable-prebuild in moon.mod.json; moon.pkg now consumes ${build.MOON_RODIO_CC_LINK_FLAGS} so native link flags are selected per-platform (darwin/linux/win32) instead of hardcoded macOS flags. Note: prebuild link_configs cannot target external packages (Moon rejects package names outside current module), so vars + moon.pkg substitution is used to achieve dynamic behavior. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (125 passed).","created_at":"2026-02-15T11:00:41Z"},{"id":45,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: bumped moon_cpal dependency from 0.10.12 to 0.11.0 in moon.mod.json as requested. Refreshed registry via moon update so the new version could resolve, then validated with moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (125 passed). No API changes were required in moon_rodio for this version bump.","created_at":"2026-02-15T11:13:41Z"},{"id":46,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: fixed a remaining sink parity bug where repeated skip_one() calls could over-decrement len() while only one skip was actually pending. Sink now keeps at most one pending skip request and decrements sound_count only once per queued skip. Added wbtest rodio::sink::tests::skip_one_accumulates_bounded_requests to lock this behavior. Also filed follow-up issue moon_rodio-vit for full rodio to_clear-style multi-skip parity across prefetch timing. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (126 passed).","created_at":"2026-02-15T11:18:31Z"},{"id":47,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: implemented rodio-style queued skip requests in sink pipeline by replacing single skip flag with to_clear counter semantics. skip_one now queues bounded clear requests without immediate len decrement; ControlledQueueSource applies queued skips in playback loop and decrements sound_count when skips are consumed. Updated wb regression test skip_one_accumulates_bounded_requests to assert deferred len updates and multi-skip behavior. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (126 passed).","created_at":"2026-02-15T14:49:54Z"},{"id":48,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: extended sink parity on runtime speed control. Added speed_with_control wrapper so set_speed affects already-queued/current sources via dynamic sample_rate/seek metadata forwarding, and switched with_done_count to DynSource::new_dynamic so those metadata changes are preserved through done tracking. Reworked sink position tracking from sample-count snapshot to per-sample Duration accumulation, so get_pos reflects runtime speed changes accurately. Added wb tests speed_runtime_update_affects_current_source and get_pos_tracks_runtime_speed_changes. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (128 passed).","created_at":"2026-02-15T14:52:23Z"},{"id":49,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: aligned sink stop/clear semantics with rodio-reference. stop() now only flips stopped flag; append() now waits for stopped queue flush via sleep_until_end before resuming; clear() now sets to_clear=len, waits, then pauses. Also fixed fallback-edge skip accounting by adding logical-source skip helper (when queue is on fallback, first skip advances to first real source, second skip drops it), and added wbtest rodio::sink::tests::stop_flushes_queue_on_poll. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (129 passed).","created_at":"2026-02-15T15:52:20Z"},{"id":50,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: improved SpatialSink runtime position propagation. Added private SpatialSinkSource wrapper that syncs emitter/ear refs into SpatialSource on every next() before sample generation, so append() no longer freezes spatial coordinates at append-time. Added whitebox regressions covering runtime updates through direct wrapper, to_dyn, sink speed/done wrappers, and full Sink queue pipeline. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (135 passed).","created_at":"2026-02-15T20:43:50Z"},{"id":51,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: aligned uniform source conversion closer to rodio UniformSourceIterator. common_source::uniform_source now bootstraps conversion by current span (cap 32768), stores target metadata (channels/rate/total_duration), and reboots converter when a span ends; try_seek now seeks underlying source and rebuilds converter state. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (135 passed).","created_at":"2026-02-15T20:49:59Z"},{"id":52,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: aligned remaining seek semantics around in-memory buffers. SamplesBuffer::try_seek now preserves current channel offset like upstream rodio (seek target aligns to channel frame then re-applies current-channel offset), and added regression test samples_buffer_seek_preserves_channel_order. StaticSamplesBuffer::try_seek now returns SeekError::NotSupported to match rodio static_buffer behavior, with corresponding test. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (137 passed).","created_at":"2026-02-16T02:07:48Z"},{"id":53,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: aligned PlayError naming with rodio stream API style. PlayError now uses DecoderError(...) variant (instead of Decode), and play() maps decoder failures to PlayError::DecoderError. Added regression test play_decode_error_variant to lock this mapping. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (138 passed).","created_at":"2026-02-16T02:09:27Z"},{"id":54,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: aligned StaticSamplesBuffer span metadata with rodio static_buffer. current_span_len now returns None (instead of remaining sample count). Added regression test static_samples_buffer_current_span_len_none and kept seek-not-supported parity test. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (139 passed).","created_at":"2026-02-16T02:10:15Z"},{"id":55,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Progress: aligned WAV decoder coverage and behavior closer to rodio wav_test by extending decode_wav_bytes beyond PCM16 to support PCM 8/16/24/32 and IEEE float32 (plus partial WAVE_FORMAT_EXTENSIBLE subformat handling). Added decoder package regressions for each supported WAV format and unsupported-format rejection. Also added native async integration tests in decoder_bridge_test that read rodio-reference/assets WAV and FLAC fixtures via async fs to verify non-silent decoding and FLAC duration expectations. Validation passed: moon info \u0026\u0026 moon fmt \u0026\u0026 moon test --target native (145 passed).","created_at":"2026-02-16T02:20:31Z"},{"id":56,"issue_id":"moon_rodio-6m5","author":"Milky2018","text":"Follow-up tracked: created moon_rodio-jhn for remaining MP4A/AAC parity gap (requires extra native decoder backend dependency).","created_at":"2026-02-16T02:21:06Z"}]}
{"id":"moon_rodio-75j","title":"Add Decoder file/reader-style input parity APIs","description":"Add non-lifecycle parity APIs for path/file-like decoder construction in MoonBit (native-focused) and tests.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-02-14T17:51:37.996088+08:00","created_by":"Milky2018","updated_at":"2026-02-14T18:00:39.113482+08:00","closed_at":"2026-02-14T18:00:39.113482+08:00","close_reason":"Closed","comments":[{"id":10,"issue_id":"moon_rodio-75j","author":"Milky2018","text":"Added native-oriented file input parity APIs for decoder: async Decoder::try_from_file(path) and Decoder::try_from_file_looped(path), implemented via moonbitlang/async/fs read_file(). Added native async test that writes WAV fixture, decodes from path, and validates looped behavior. Validation: moon test --target native (96/96).","created_at":"2026-02-14T10:00:39Z"}]}
{"id":"moon_rodio-9ev","title":"Fill remaining non-lifecycle parity gaps with rodio-reference","description":"Complete remaining non-lifecycle differences: Source metadata/seek contract, decoder builder settings behavior, and reader/file input parity API for Decoder while keeping native backend.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-02-14T17:51:26.359797+08:00","created_by":"Milky2018","updated_at":"2026-02-14T18:00:45.675527+08:00","closed_at":"2026-02-14T18:00:45.675527+08:00","close_reason":"Closed","dependencies":[{"issue_id":"moon_rodio-9ev","depends_on_id":"moon_rodio-9tn","type":"blocks","created_at":"2026-02-14T17:51:52.374201+08:00","created_by":"Milky2018"},{"issue_id":"moon_rodio-9ev","depends_on_id":"moon_rodio-b6o","type":"blocks","created_at":"2026-02-14T17:51:52.471977+08:00","created_by":"Milky2018"},{"issue_id":"moon_rodio-9ev","depends_on_id":"moon_rodio-75j","type":"blocks","created_at":"2026-02-14T17:51:52.56622+08:00","created_by":"Milky2018"}],"comments":[{"id":11,"issue_id":"moon_rodio-9ev","author":"Milky2018","text":"Completed all tracked non-lifecycle parity gaps: Source metadata/seek contract, DecoderBuilder seek behavior, and Decoder file-input parity APIs; all validations passed on native target (moon fmt \u0026\u0026 moon info \u0026\u0026 moon test --target native, 96/96).","created_at":"2026-02-14T10:00:45Z"},{"id":12,"issue_id":"moon_rodio-9ev","author":"Milky2018","text":"Post-close parity hardening: DynSource now preserves Source metadata/seek via closures (instead of erasing to defaults), and named wrappers forward current_span_len/total_duration/try_seek through inner source. Added regression tests for to_dyn and wrapper seek forwarding. Validation: moon fmt \u0026\u0026 moon info \u0026\u0026 moon test --target native (98/98).","created_at":"2026-02-14T10:03:57Z"}]}
{"id":"moon_rodio-9tn","title":"Extend Source trait with span/duration/seek metadata","description":"Add current_span_len/total_duration/try_seek API and wire through core source types and tests.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-02-14T17:51:29.719345+08:00","created_by":"Milky2018","updated_at":"2026-02-14T18:00:28.362108+08:00","closed_at":"2026-02-14T18:00:28.362108+08:00","close_reason":"Closed","comments":[{"id":8,"issue_id":"moon_rodio-9tn","author":"Milky2018","text":"Implemented Source parity extension: trait now includes current_span_len/total_duration/try_seek; all Source impls across package updated. Added concrete metadata+seek behavior for SamplesBuffer, StaticSamplesBuffer, Chirp, Decoder and LoopedDecoder; default behavior returns None / SeekError::NotSupported for non-seekable wrappers. Added tests for metadata and default seek contract. Validation: moon fmt \u0026\u0026 moon info \u0026\u0026 moon test --target native (96/96).","created_at":"2026-02-14T10:00:28Z"}]}
{"id":"moon_rodio-b6o","title":"Implement effective DecoderBuilder seek settings and decoder seek behavior","description":"Use settings.with_seekable/with_byte_len to control decoder seek support and expose behavior through Source::try_seek where applicable.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-02-14T17:51:34.527285+08:00","created_by":"Milky2018","updated_at":"2026-02-14T18:00:33.853638+08:00","closed_at":"2026-02-14T18:00:33.853638+08:00","close_reason":"Closed","comments":[{"id":9,"issue_id":"moon_rodio-b6o","author":"Milky2018","text":"Implemented effective DecoderBuilder seek semantics: builder now applies settings.is_seekable to built Decoder/LoopedDecoder. Decoder/LoopedDecoder Source::try_seek now checks seekability and seeks via decoded sample cursor when enabled. Added decoder-side metadata methods for span/total_duration and tests covering seekable/non-seekable builder combinations (including with_byte_len + with_seekable(false)). Validation: moon test --target native (96/96).","created_at":"2026-02-14T10:00:33Z"}]}
{"id":"moon_rodio-cri","title":"Implement sink/stream semantic parity","description":"Close remaining semantic gaps versus rodio-reference in sink/stream lifecycle and control behavior.","notes":"Focus areas: sleep_until_end behavior, detach/drop semantics, seek behavior contract, and from_iter namespace/behavior gap.\nAdjusted naming conflict: source chain constructor is now from_iter(Array[DynSource]); buffer helper renamed to buffer_from_iter.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-02-14T16:31:29.028274+08:00","created_by":"Milky2018","updated_at":"2026-02-14T17:37:35.833174+08:00","closed_at":"2026-02-14T17:37:35.833174+08:00","close_reason":"Closed","comments":[{"id":1,"issue_id":"moon_rodio-cri","author":"Milky2018","text":"Implemented additional rodio parity slice: expanded noise generators (WhiteTriangular/WhiteGaussian/Velvet/Blue/Violet/Brownian), AGC control handles, reverb and distortion_with_gain APIs, periodic/repeat/fade aliases, wrapper inner accessors, and sink try_seek/get_pos semantic fixes. Validation: moon test --target native passed (77/77).","created_at":"2026-02-14T08:54:24Z"},{"id":2,"issue_id":"moon_rodio-cri","author":"Milky2018","text":"Follow-up parity additions: LimitSettings builder/preset API surface (with_threshold/with_knee_width/with_attack/with_release and dynamic_content/broadcast/mastering/gaming/live_performance), SignalGenerator::with_function alias, and accessor aliases tested. Revalidated native tests: 77/77.","created_at":"2026-02-14T08:55:58Z"},{"id":3,"issue_id":"moon_rodio-cri","author":"Milky2018","text":"Implemented queue end-signal support (append_with_signal + QueueSignal) and switched Sink::sleep_until_end to signal-based waiting instead of pure length spin. Added queue signal test; full native test suite now 78/78.","created_at":"2026-02-14T08:57:32Z"},{"id":4,"issue_id":"moon_rodio-cri","author":"Milky2018","text":"Remaining gap tracked: Rust Drop-driven detach/stop lifecycle cannot be mirrored 1:1 in MoonBit today; behavior currently exposed via explicit Sink controls instead of automatic destructor hooks.","created_at":"2026-02-14T08:58:46Z"},{"id":5,"issue_id":"moon_rodio-cri","author":"Milky2018","text":"Added more non-lifecycle parity: mutable wrapper APIs for Amplify/ChannelVolume/Distortion/Speed (setters + inner accessors), expanded wrapper accessor surface, added math module parity functions (lerp/db_to_linear/linear_to_db), and added conversion type wrappers (ChannelCountConverter/SampleRateConverter/SampleTypeConverter) with tests. Native tests now 86/86.","created_at":"2026-02-14T09:22:50Z"},{"id":6,"issue_id":"moon_rodio-cri","author":"Milky2018","text":"Added finite-silence parity APIs: zero_samples(...) and Zero::new_samples(...), with tests for raw source and named wrappers. Native test suite remains green (86/86).","created_at":"2026-02-14T09:25:05Z"},{"id":7,"issue_id":"moon_rodio-cri","author":"Milky2018","text":"Added non-lifecycle parity slice: Decoder::builder(), DecoderBuilder (with_data/with_hint/with_mime_type/with_seekable/with_gapless/with_coarse_seek/with_byte_len), Settings::default(), Decoder::new_looped(), and LoopedDecoder Source implementation. Also generalized from_iter to Array[S : Source] (still supports DynSource) and added async-fs native output_to_wav with header validation test. Validation: moon fmt \u0026\u0026 moon info \u0026\u0026 moon test --target native (91/91). Remaining known warning: moonbitlang/async import appears unused in moon info but is required for async test compilation.","created_at":"2026-02-14T09:36:11Z"}]}
{"id":"moon_rodio-cum","title":"Improve Source metadata forwarding parity for wrappers","description":"Forward current_span_len/total_duration/try_seek through wrapper inner sources where applicable; align LoopedDecoder total_duration semantics.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-02-14T18:05:15.198088+08:00","created_by":"Milky2018","updated_at":"2026-02-14T18:11:20.990985+08:00","closed_at":"2026-02-14T18:11:20.990985+08:00","close_reason":"done","comments":[{"id":13,"issue_id":"moon_rodio-cum","author":"Milky2018","text":"Completed: forwarded current_span_len/total_duration/try_seek for Done/controls/converters/AGC/Blt/PeriodicAccess/TrackPosition/SpatialSource; aligned UniformSourceIterator total_duration+try_seek and FromIter current_span_len+try_seek defaults; aligned LoopedDecoder total_duration=None and seek error for empty source; updated tests and verified moon test --target native (100/100).","created_at":"2026-02-14T10:11:20Z"}]}
{"id":"moon_rodio-e1s","title":"Rodio migration phase 2","description":"Fix moon_cpal link flags for tests; import decoder references; add rodio decoder subpackages and first parser/tests.","notes":"Decoder backends now: MP3=minimp3, FLAC=dr_flac, Vorbis=stb_vorbis (all native FFI + non-native stubs).\nSwitch decoder package to native-only mode: remove non-native stubs; keep preferred-target native.","status":"closed","priority":1,"issue_type":"epic","owner":"842376130@qq.com","created_at":"2026-02-13T22:09:56.808091+08:00","created_by":"Milky2018","updated_at":"2026-02-14T10:32:42.40154+08:00","closed_at":"2026-02-14T10:32:42.40154+08:00","close_reason":"All planned migration tasks completed: native-only decoder backends (WAV/MP3/FLAC/Vorbis), root Decoder/play API, and queue/sink parity tests enabled."}
{"id":"moon_rodio-e1s.1","title":"Add cross-platform cc-link-flags for moon_cpal test linking","description":"Add explicit native linker flags in this repo so moon test can link moon_cpal backend libs on macOS/Linux/Windows.","notes":"Added native cc-link-flags in moon.pkg and verified moon test passes on macOS with CoreAudio frameworks.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-02-13T22:13:31.492192+08:00","created_by":"Milky2018","updated_at":"2026-02-13T22:16:47.426885+08:00","closed_at":"2026-02-13T22:16:47.426885+08:00","close_reason":"Closed","dependencies":[{"issue_id":"moon_rodio-e1s.1","depends_on_id":"moon_rodio-e1s","type":"parent-child","created_at":"2026-02-13T22:13:31.493237+08:00","created_by":"Milky2018"}]}
{"id":"moon_rodio-e1s.2","title":"Clone decoder reference repos","description":"Clone upstream rust decoder repos into *-reference dirs and ignore them in git.","notes":"Cloned mp3-reference(minimp3_fixed 0.5.4), wav-reference(hound 3.5.0), flac-reference(claxon 0.4.2), vorbis-reference(lewton 0.10.2) and added ignore rules.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-02-13T22:13:38.382757+08:00","created_by":"Milky2018","updated_at":"2026-02-13T22:16:47.427844+08:00","closed_at":"2026-02-13T22:16:47.427844+08:00","close_reason":"Closed","dependencies":[{"issue_id":"moon_rodio-e1s.2","depends_on_id":"moon_rodio-e1s","type":"parent-child","created_at":"2026-02-13T22:13:38.383658+08:00","created_by":"Milky2018"}]}
{"id":"moon_rodio-e1s.3","title":"Create decoder subpackages and port first slice","description":"Add rodio decoder subpackages in MoonBit, port tests first, then implement first minimal decoder path.","notes":"Added subpackage username/moon_rodio/decoder with DecoderError/DecodedSamples, implemented decode_wav_bytes (PCM16), added stub APIs for mp3/flac/vorbis, and added 5 tests passing.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-02-13T22:13:45.347959+08:00","created_by":"Milky2018","updated_at":"2026-02-13T22:20:43.973736+08:00","closed_at":"2026-02-13T22:20:43.961459+08:00","close_reason":"Closed","dependencies":[{"issue_id":"moon_rodio-e1s.3","depends_on_id":"moon_rodio-e1s","type":"parent-child","created_at":"2026-02-13T22:13:45.348989+08:00","created_by":"Milky2018"}]}
{"id":"moon_rodio-e1s.4","title":"Port MP3 decoder from minimp3_fixed","description":"Port minimal MP3 frame decode path from mp3-reference into username/moon_rodio/decoder.","notes":"Started native MP3 decoder integration based on minimp3_fixed reference. Introduce minimp3 C core as decoder backend.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-02-13T22:22:00.115814+08:00","created_by":"Milky2018","updated_at":"2026-02-13T22:28:46.922111+08:00","closed_at":"2026-02-13T22:28:46.922111+08:00","close_reason":"Implemented native MP3 decoder using minimp3 backend; added tests with ILL2_mono vector.","dependencies":[{"issue_id":"moon_rodio-e1s.4","depends_on_id":"moon_rodio-e1s","type":"parent-child","created_at":"2026-02-13T22:22:00.117212+08:00","created_by":"Milky2018"}]}
{"id":"moon_rodio-e1s.5","title":"Port FLAC decoder from claxon","description":"Port FLAC stream reader slice from flac-reference into username/moon_rodio/decoder.","notes":"Started FLAC decoder migration analysis from claxon reference.\nBlocking for backend decision: claxon is a full pure-Rust FLAC decoder (~3.6k LOC across bitreader/frame/subframe/CRC). Recommend introducing a dedicated FLAC decode backend (community MoonBit package or vetted native library).\nUser approved native backend for FLAC/Vorbis; proceed with FFI-based implementation.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-02-13T22:22:00.2311+08:00","created_by":"Milky2018","updated_at":"2026-02-13T23:54:17.87654+08:00","closed_at":"2026-02-13T23:54:17.87654+08:00","close_reason":"Implemented FLAC decode via native FFI using dr_flac; added decoder tests and non-native stub.","dependencies":[{"issue_id":"moon_rodio-e1s.5","depends_on_id":"moon_rodio-e1s","type":"parent-child","created_at":"2026-02-13T22:22:00.23204+08:00","created_by":"Milky2018"}]}
{"id":"moon_rodio-e1s.6","title":"Port Vorbis decoder from lewton","description":"Port Ogg/Vorbis decode slice from vorbis-reference into username/moon_rodio/decoder.","notes":"Start Vorbis implementation together with FLAC via native FFI backend.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-02-13T22:22:00.348272+08:00","created_by":"Milky2018","updated_at":"2026-02-13T23:54:17.892847+08:00","closed_at":"2026-02-13T23:54:17.892847+08:00","close_reason":"Implemented Vorbis decode via native FFI using stb_vorbis; added decoder tests and non-native stub.","dependencies":[{"issue_id":"moon_rodio-e1s.6","depends_on_id":"moon_rodio-e1s","type":"parent-child","created_at":"2026-02-13T22:22:00.349409+08:00","created_by":"Milky2018"}]}
{"id":"moon_rodio-e1s.7","title":"Port root Decoder/play API and wire decoder package","description":"Expose Decoder/Play APIs in username/moon_rodio using native decoder package and Source integration.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-02-14T10:28:12.392303+08:00","created_by":"Milky2018","updated_at":"2026-02-14T10:32:36.100325+08:00","closed_at":"2026-02-14T10:32:36.100325+08:00","close_reason":"Implemented root Decoder/play API with native decoder integration and added coverage tests.","dependencies":[{"issue_id":"moon_rodio-e1s.7","depends_on_id":"moon_rodio-e1s","type":"parent-child","created_at":"2026-02-14T10:28:12.393544+08:00","created_by":"Milky2018"}]}
{"id":"moon_rodio-h3v","title":"Rename module path to Milky2018/moon_rodio","description":"Replace all username/moon_rodio references with Milky2018/moon_rodio and verify build/tests.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-02-14T10:52:01.791982+08:00","created_by":"Milky2018","updated_at":"2026-02-14T10:52:31.374638+08:00","closed_at":"2026-02-14T10:52:31.374638+08:00","close_reason":"Replaced module path references with Milky2018/moon_rodio and verified native tests."}
{"id":"moon_rodio-jhn","title":"Add native MP4A/AAC decoder support for rodio parity","description":"rodio-reference includes tests for mp4a/aac decoding (tests/mp4a_test.rs), but moon_rodio currently has no native MP4A decoder path in decoder_bridge/decoder package. Implement native backend support (port or FFI) and wire Decoder::new/DecoderBuilder auto-detection for m4a/mp4a so parity can be completed. This likely requires introducing an additional AAC/MP4 demux+decode dependency.","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-02-16T10:21:02.095675+08:00","created_by":"Milky2018","updated_at":"2026-02-16T10:21:02.095675+08:00","labels":["decoder","native","parity"]}
{"id":"moon_rodio-mdr","title":"Align duration filters metadata/seek semantics","description":"Bring take_duration, skip_duration, and delay metadata/seek behavior closer to rodio and add coverage tests.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-02-14T20:00:56.773142+08:00","created_by":"Milky2018","updated_at":"2026-02-14T20:01:01.432928+08:00","closed_at":"2026-02-14T20:01:01.432928+08:00","close_reason":"done","comments":[{"id":17,"issue_id":"moon_rodio-mdr","author":"Milky2018","text":"Implemented: precise duration helpers (compare/min/add/saturating_sub), take_duration metadata+seek state tracking, skip_duration total_duration saturation, delay metadata+seek compensation for pre-delay and post-delay regions; added regression tests for these behaviors.","created_at":"2026-02-14T12:01:01Z"}]}
{"id":"moon_rodio-okj","title":"Upgrade moon_cpal to 0.10.12 and restore sub-second duration parity","description":"Bump dependency to moon_cpal 0.10.12, adopt new Duration constructors, and implement nanos-level parity where previously blocked.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-02-14T19:56:06.735194+08:00","created_by":"Milky2018","updated_at":"2026-02-14T19:58:48.973667+08:00","closed_at":"2026-02-14T19:58:48.973667+08:00","close_reason":"done","comments":[{"id":16,"issue_id":"moon_rodio-okj","author":"Milky2018","text":"Completed with moon_cpal 0.10.12: upgraded dependency, switched to Duration::new for sub-second construction, restored nanos precision in duration_from_sample_count and TrackPosition::get_pos, and added sub-second parity tests for SamplesBuffer, TrackPosition, and Sink::get_pos. Also fixed integer overflow in nanos math by moving sample-duration arithmetic to UInt64.","created_at":"2026-02-14T11:58:48Z"}]}
{"id":"moon_rodio-vit","title":"Audit sink skip pipeline against rodio to_clear semantics","description":"Follow up parity work: sink skip requests are currently collapsed to a single pending flag in moon_rodio. Upstream rodio uses a to_clear counter processed in periodic callback; audit and align behavior for multiple rapid skip_one/clear interactions and len() updates across prefetch boundaries.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-02-15T19:18:22.394475+08:00","created_by":"Milky2018","updated_at":"2026-02-15T22:49:58.858087+08:00","closed_at":"2026-02-15T22:49:58.858087+08:00","close_reason":"Closed"}
